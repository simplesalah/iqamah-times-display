<html>

<head>
	<link rel="stylesheet" type="text/css" href="styles.css"> 
	<meta http-equiv="refresh" content="3600">
</head>

<body onload="updateTimes()">
	<div class="salah-times">
	<table>
		<tr><td></td><td>Athan</td><td>Iqamah</td>
		<tr>
			<td>Fajr</td>
			<td><span id="fajr-athan"></span></td>
			<td><span id="fajr"></span></td>
		</tr>
		<tr>
			<td>Dhuhr</td>
			<td><span id="dhuhr-athan"></span></td>
			<td><span id="dhuhr"></span></td>
		</tr>
		<tr>
			<td>Asr</td>
			<td><span id="asr-athan"></span></td>
			<td><span id="asr"></span></td>
		</tr>
		<tr>
			<td>Maghrib</td>
			<td><span id="maghrib-athan"></span></td>
			<td><span id="maghrib"></span></td>
		</tr>
		<tr>
			<td>Isha</td>
			<td><span id="isha-athan"></span></td>
			<td><span id="isha"></span></td>
		</tr>
		<tr>
			<td>1st Jumu'ah</td>
			<td colspan="2">Lecture: <span id="english1"></span> <br/>
							Khutba: <span id="arabic1"></span>
			</td>
		</tr>
		<tr>
			<td>2nd Jumu'ah</td>
			<td colspan="2">Lecture: <span id="english2"></span> <br/>
							Khutba: <span id="arabic2"></span>
			</td>
		</tr>
	</table>
	</div> 

	<div class="events-slideshow">
	<iframe src="https://docs.google.com/presentation/d/SLIDESHOW-ID-HERE/embed?start=true&loop=true&delayms=10000" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>
	</div>

	<script>
		function updateTimes() {
			fetch('https://us-central1-simple-salah-1546243001528.cloudfunctions.net/getIqamah')
			.then((resp) => resp.json())
			.then((data) => {
				let newTimes = data.values[0];
				let mode = data.values[2][1];
				let elementIds = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha', 
								'english1', 'arabic1', 'english2', 'arabic2'];
				for (let i=0; i<elementIds.length; i++) {
					let prayerName = elementIds[i];
					let iqamahTime = newTimes[i];
					try {
						document.getElementById(prayerName).textContent = iqamahTime;
					}
					catch (e) {
						console.error(e);
					}
				}

				document.getElementById("fajr-athan").textContent = newTimes["fajr-athan"];
				document.getElementById("dhuhr-athan").textContent = newTimes["dhuhr-athan"];
				document.getElementById("asr-athan").textContent = newTimes["asr-athan"];
				document.getElementById("maghrib-athan").textContent = newTimes["maghrib-athan"];
				document.getElementById("isha-athan").textContent = newTimes["isha-athan"];
			})
			.catch((error) => {
				console.error(error);
			});
		}
		
		setInterval(updateTimes, 60000);
	</script>
</body>
</html>
